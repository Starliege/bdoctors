<template>
    <div>

        <div class="row">
            <div class="col-12 col-md-4">
                <h4>Cerca un medico per specializzazione</h4>
                <select name="" id="" v-model="filterText" class="form-control">
                    <option value="">Scegli la specializzazione</option>
                    <option :value="specialization.specialization" v-for="specialization in SpecsArray"
                        :key="specialization.id">
                        {{ specialization.specialization }}</option>
                </select>
                <router-link :to="{ name: 'search'}">
                    <button @click=filter()>
                        Cerca
                    </button>
                </router-link>
            </div>
        </div>



        <!-- <div class="row py-5">
            <div v-for="doc in filteredDoctors" class="card mx-3 " style="width: 18rem;">
                <div class="img-box">
                    <img v-if="doc.image" :src="`/storage/${doc.image}`" class="card-img-top" alt="...">
                    <img src="http://mascitelliandpartners.com/map/wp-content/uploads/2015/03/placeholder_user.png"
                        class="card-img-top" v-else>

                </div>

                <div class="card-body">
                    {{ doc.name }} {{ doc.surname }}

                    <ul>
                        <li v-for="spec in doc.specializations" :key="spec.id">
                            {{ spec.specialization }}

                        </li>
                    </ul>

                    <p v-if=" doc.reviews.length <= 0">nessuna recensione</p>
                    <p v-else-if="doc.reviews.length == 1">{{doc.reviews.length}} recensione</p>
                    <p v-else>{{doc.reviews.length}} recensioni</p>

                    <p v-if="doc.stars.length <= 0">nessun voto disponibile</p>
                    <p v-else>{{doc.avg}}</p>
                    <router-link :to="{ name: 'doctor.details', params: {id: doc.id }}">show</router-link>
                </div>
            </div>
        </div> -->
    </div>
</template>

<script>

import state from '../store.js';

export default {
    name: "SearchBarSel",
    data() {
        return {
            filterText: '',
            doctorsArray: [],
            filteredbySpec: [],
            specs: [],
            SpecsArray: [],


        }
    },
    computed:{
      doctorsComputed(){
          console.log(state.doctors , 'dottori computed')
        return state.doctors
      },
      filteredDoctors(){
        console.log(state.filteredDocs, 'dottori filrati computed')

        return state.filteredDocs
      }
    },
    beforeMount() {
        this.fetchSpecs()
        this.fetchDoctors()

    },
   
    methods: {
        fetchDoctors() {
            axios.get('/api/users').then((res) => {
               state.doctors = res.data.result
                // console.log(this.doctorsArray)
            })


        },
        fetchSpecs() {
            axios.get('/api/specializations').then((res) => {
                this.SpecsArray = res.data
                // console.log(this.SpecsArray)
            })
        },
        filter() {
            state.filteredDocs = [],
                state.doctors.forEach(el => {
                    el.visible = false
                    this.specs = el.specializations
                    el.total = 0
                    el.stars.forEach(star => {
                        el.total += star.vote

                        // console.log(star)
                    });
                    el.avg =  Math.floor(el.total/el.stars.length)
                    // el.avg = Math.round(2)
                    console.log(this.filterText)
                    this.specs.forEach(spec => {

                        if (spec.specialization == this.filterText) {
                            el.visible = true
                            state.filteredDocs.push(el)
                        }
                    });
                });
            // console.log(this.filteredbySpec)
        },

        
    },
}
</script>

<style lang="scss" scoped>

</style>